== Logtash-Forwarder to Filebeat Migration

The following guide should help you to upgrade from the logstash-fordwader to filebeat.

There are four major changes:
* The config file was restructured and converted from json to yaml
* The registry file which stores the state of the logstash-fowarder was renamed
* Command line options were removed and moved to the confg file
* Configuration options for outputs are inherited from libbeat. Details can be found https://www.elastic.co/guide/en/beats/libbeat/current/index.html[here]

Here is a simple example how a simple config from logstash-forwarder can be migrated to filebeat:

=== logstash-forwarder.json
[source,json]
-------------------------------------------------------------------------------------
{
  "files": [
    {
      "paths": [
        "/var/log/*.log"
      ],
      "fields": { "type": "syslog" }
    }
  ],
  "network": {
    "servers": [ "localhost:5043" ],
  }
}
-------------------------------------------------------------------------------------

=== filebeat.yml
[source,yaml]
-------------------------------------------------------------------------------------
filebeat:
  prospectors:
    -
      paths:
        - /var/log/*.log
    fields:
      type: syslog
output:
  elasticsearch:
    enabled: true
    hosts: ["http://localhost:5043"]
-------------------------------------------------------------------------------------

=== Command Line Options
Most command line options from logstash-forwarder have been removed and migrated to config file options. The only mandatory
option for filebeat is `-c` with the path to the config file to be loaded. In case you used command line options with
logstash-forwarder, make sure to add your options to the configuration file. For the naming changes, check the list below.

The general concept for the config options is that all options are available as part of the config file and only some
special options are also available as command line option.

==== Renamed options
The renamed command line options are listed below. Also check Config Options below for options that were either completely
removed or moved to libbeat.

[cols="3*", options="header"]
|===
|Command Line Option
|Config File Option
|Description

|`-config`
|`-c`
|The config options was split up in two part. The base and required config is linked with -c. Additional config files can be linked as part of the config file. Note: Additional config files must be in a different directory than the main config file.

|`-config`
|`config_dir`
|Path to directory with additional configuration files

|`-idle-timeout`
|`idle_timeout`
|`idle_timeout` was moved to the config file and removed as flag.

|`-spool-size`
|`spool_size`
|`spool_size` was moved to the config file and removed as flag.

|`-harvester-buff-size`
|`harvester_buffer_size`
|`harvester_buffer_size` was moved to the config file and removed as flag. It can now be configured specific for each harvester.

|`-tail`
|`tail_on_rotate`
|`tail_on_rotate` was moved to the config file and removed as flag. It can now be configured specific for each harvester.

|`-cpuProfileFile`
|
|`cpuProfileFile` option was removed. The profiling options of libbeat can be used instead. For more details on profiling see https://github.com/elastic/libbeat/issues/122

|`-quiet`
|
|The `quiet` option was removed. Libbeat is used for logging and the libbeat configuration options have to be used.


|===



==== Config Options
With the refactoring of the configuration file, some options were also removed or renamed. Below is a list with the changed entries:

[cols="2*", options="header"]
|===
|Config Option
|Action

|`deadTime`
|`deadTime` was renamed to `ignore_older`. In case a file is not changed for `ignore_older`, the file handler will be closed. If the file is changed again after ignore_older has passed, it is be reopened.

|`netTimeout`
|`netTimeout` was removed as it is replaced by the Timeout option in libbeat.

|`log-to-syslog` and `syslog`
|Both options were removed as logging is part of the libbeat config.

|===


==== Renamed config options
* DeadTime was renamed to ignore_older


===  Registry file

The registry file stores the state and location from which Filbeat was reading last. Under logstash-forwarder was called
`.logstash-fowarder`. For Filebeat it was renamed to `.filebeat`. For enhancements reasons, especially for Windows the
structure of the registry file has been changed. This makes a migration complex and leads to potential errors.

Instead of a migration we recommend to start Filebeat on the same host and send the log files to a different index.
This will start indexing from scratch. In case it is preferred to start at the end of all files, the option tail_on_rotate
can be set to true.

The above will allow to keep the old logstash-forwarder running and it can be slowly switched over to Filebeat.
